{% load static %}

<link rel="stylesheet" href="{% static 'consult/consult.css' %}?v=13">

<style>
  /* ====== MODAL ====== */
  .saif-modal .modal-content {
    border: 0; border-radius: 18px; overflow: hidden;
    box-shadow: 0 18px 45px rgba(14,122,58,.25);
    font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  }
  .saif-modal .modal-header {
    background: #0f7a3a; color: #fff; border-bottom: 0; padding: .9rem 1.1rem;
  }
  .saif-modal .modal-body {
    background: #f7fbf9; padding: 1rem 1.1rem; max-height: 72vh; overflow: auto;
  }
  .saif-modal .modal-footer { border-top: 0; background: #fff; }

  /* ====== STATS ====== */
  .stats {
    display: grid; gap: .9rem;
    grid-template-columns: repeat(4, 1fr);
  }
  @media (max-width: 992px){ .stats{ grid-template-columns: 1fr 1fr; } }
  @media (max-width: 576px){ .stats{ grid-template-columns: 1fr; } }

  .stat {
    display: flex; gap: .75rem; align-items: flex-start; background: #fff;
    border: 1px solid #e5e7eb; border-radius: 14px; padding: .85rem .95rem;
    box-shadow: 0 6px 16px rgba(15,23,42,.06);
  }
  .stat .ico {
    flex: 0 0 36px; height: 36px; width: 36px; border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    background: #ecfdf5; color: #0E7A3A; border: 1px solid #a7f3d0; font-size: 1.05rem;
  }
  .stat .lbl { font-weight: 800; color: #0b1220; margin-top: .1rem; }
  .stat .val { color: #111827; margin-top: .1rem; word-break: break-word; line-height: 1.35; }

  .chip-est {
    display: inline-flex; align-items: center; gap: .35rem;
    padding: .24rem .55rem; border-radius: 999px;
    font-weight: 700; font-size: .82rem; border: 1px solid transparent;
  }
  .chip--ok { background: #ecfdf5; color: #065f46; border-color: #a7f3d0; }
  .chip--neutral { background: #f3f4f6; color: #374151; border-color: #e5e7eb; }

  /* ====== BLOQUES ====== */
  .block {
    background: #fff; border: 1px solid #e5e7eb; border-radius: 14px;
    box-shadow: 0 8px 18px rgba(15,23,42,.06);
  }
  .block-header {
    padding: .75rem .95rem; border-bottom: 1px solid #eef2f7;
    font-weight: 800; color: #0b1220; display: flex; align-items: center; gap: .5rem;
  }
  .block-body { padding: .8rem .9rem; }

  /* ====== TABLA ====== */
  .table thead th {
    background: #e8f5ec !important;
    color: #0b3f2e;
    border-bottom: 1px solid #d7dbdf !important;
  }
</style>

<div class="saif-modal">
  <!-- HEADER -->
  <div class="modal-header">
    <div class="saif-modal-title">
      <span class="saif-modal-icon"><i class="bi bi-box-arrow-up"></i></span>
      <span>Detalle de Salida por Ajuste</span>
    </div>
    <span class="saif-badge">SAIF</span>
    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
  </div>

  <!-- BODY -->
  <div class="modal-body">
    <!-- STATS -->
    <div class="stats mb-3">
      <!-- Estado -->
      <div class="stat">
        <div class="ico"><i class="bi bi-flag"></i></div>
        <div>
          <div class="lbl">Estado</div>
          <div class="val">
            {% if ajuste.estado|lower == "completado" %}
              <span class="chip-est chip--ok"><i class="bi bi-check2-circle"></i> Completado</span>
            {% elif ajuste.estado|lower == "cancelado" %}
              <span class="chip-est chip--neutral"><i class="bi bi-x-circle"></i> Cancelado</span>
            {% else %}
              <span class="chip-est chip--neutral"><i class="bi bi-circle"></i> {{ ajuste.estado|default:"Desconocido" }}</span>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Usuario -->
      <div class="stat">
        <div class="ico"><i class="bi bi-person-circle"></i></div>
        <div>
          <div class="lbl">Usuario</div>
          <div class="val">{{ ajuste.id_usuario.nombre }} {{ ajuste.id_usuario.apellido }}</div>
        </div>
      </div>

      <!-- Fecha -->
      <div class="stat">
        <div class="ico"><i class="bi bi-calendar-event"></i></div>
        <div>
          <div class="lbl">Fecha del Ajuste</div>
          <div class="val">{{ ajuste.fecha_conteo|date:"d/m/Y" }}</div>
        </div>
      </div>

      <!-- ID Ajuste -->
      <div class="stat">
        <div class="ico"><i class="bi bi-upc-scan"></i></div>
        <div>
          <div class="lbl">ID Ajuste</div>
          <div class="val">#{{ ajuste.id }}</div>
        </div>
      </div>
    </div>

    <!-- DETALLE -->
    <div class="block">
      <div class="block-header"><i class="bi bi-box"></i> Detalle de Productos Retirados</div>
      <div class="block-body">
        <div class="table-responsive">
          <table class="table table-bordered align-middle text-center">
            <thead>
              <tr>
                <th>Código</th>
                <th>Producto</th>
                <th>Lote</th>
                <th>Cantidad Anterior</th>
                <th>Cantidad Nueva</th>
                <th>Diferencia (−)</th>
              </tr>
            </thead>
            <tbody>
              {% for d in detalles %}
              <tr>
                <td>{{ d.id_lote.id_producto.codigo_producto }}</td>
                <td class="text-start">{{ d.id_lote.id_producto.nombre }}</td>
                <td>{{ d.id_lote.numero_lote }}</td>
                <td>{{ d.cantidad_sistema }}</td>
                <td>{{ d.cantidad_contada }}</td>
                <td class="text-danger fw-semibold">{{ d.diferencia }}</td>
              </tr>
              {% empty %}
              <tr><td colspan="6" class="text-muted">Sin productos retirados</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- FOOTER -->
  <div class="modal-footer py-2">
    <button type="button" class="btn btn-outline-secondary rounded-pill px-3" data-bs-dismiss="modal">
      <i class="bi bi-x-lg"></i> Cerrar
    </button>
  </div>
</div>
