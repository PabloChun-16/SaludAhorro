{% extends "home/base.html" %}
{% load static %}

{% block title %}Inicio · Farmacia Salud y Ahorro{% endblock %}

{% block content %}
<!-- ================= HERO / CARRUSEL ================= -->
<section id="hero" class="relative w-full overflow-hidden bg-green-700/5" aria-labelledby="hero-title">
  <div
    id="slider"
    class="relative aspect-[25/9] min-h-[52vh] md:min-h-[60vh]"
    role="region"
    aria-roledescription="carrusel"
    aria-label="Promociones destacadas"
    tabindex="0"
  >
    <!-- Slide 1 -->
    <div class="absolute inset-0 opacity-100 transition-opacity duration-700 ease-out" data-slide aria-hidden="false">
      <img src="{% static 'home/img/carusel 1.jpg' %}" class="w-full h-full object-cover object-[25%_center]" alt="Promoción 1: Tu salud es prioridad" />
      <div class="absolute inset-0 bg-gradient-to-r from-black/50 to-transparent"></div>
      <div class="absolute left-6 md:left-16 top-1/2 -translate-y-1/2 text-white max-w-xl" data-reveal>
        <h1 id="hero-title" class="text-4xl md:text-6xl font-extrabold leading-tight">
          Bienvenidos<br><span class="text-emerald-300">Tu salud es prioridad</span>
        </h1>
        <a href="#productos" class="btn btn-primary mt-5 inline-block">Comprar ahora</a>
      </div>
    </div>

    <!-- Slide 2 -->
    <div class="absolute inset-0 opacity-0 transition-opacity duration-700 ease-out" data-slide aria-hidden="true">
      <img src="{% static 'home/img/carusel 2.jpg' %}" class="w-full h-full object-cover object-[25%_center]" alt="Promoción 2: Asesoría profesional" />
      <div class="absolute inset-0 bg-gradient-to-r from-black/50 to-transparent"></div>
      <div class="absolute left-6 md:left-16 top-1/2 -translate-y-1/2 text-white max-w-xl" data-reveal>
        <h2 class="text-4xl md:text-6xl font-extrabold">
          Vive Bien<br><span class="text-emerald-300">Asesoría profesional</span>
        </h2>
        <a href="#empresa" class="btn btn-primary mt-5 inline-block">Conócenos</a>
      </div>
    </div>

    <!-- Slide 3 -->
    <div class="absolute inset-0 opacity-0 transition-opacity duration-700 ease-out" data-slide aria-hidden="true">
      <img src="{% static 'home/img/carusel 3.jpg' %}" class="w-full h-full object-cover object-[25%_center]" alt="Promoción 3: Ofertas con precios accesibles" />
      <div class="absolute inset-0 bg-gradient-to-r from-black/50 to-transparent"></div>
      <div class="absolute left-6 md:left-16 top-1/2 -translate-y-1/2 text-white max-w-xl" data-reveal>
        <h2 class="text-4xl md:text-6xl font-extrabold">
          Ofertas<br><span class="text-emerald-300">Precios accesibles</span>
        </h2>
        <a href="#productos" class="btn btn-primary mt-5 inline-block">Ver destacados</a>
      </div>
    </div>

    <!-- Controles del carrusel -->
    <div class="pointer-events-none absolute inset-0">
      <div class="pointer-events-auto">
        <button id="prev" class="absolute left-3 top-1/2 -translate-y-1/2 grid place-items-center w-10 h-10 rounded-full bg-white/85 hover:bg-white shadow focus:outline-none focus:ring-2 focus:ring-emerald-500/40" aria-label="Anterior">
          <span aria-hidden="true">❮</span>
        </button>
        <button id="next" class="absolute right-3 top-1/2 -translate-y-1/2 grid place-items-center w-10 h-10 rounded-full bg-white/85 hover:bg-white shadow focus:outline-none focus:ring-2 focus:ring-emerald-500/40" aria-label="Siguiente">
          <span aria-hidden="true">❯</span>
        </button>
      </div>
    </div>

    <!-- Indicadores -->
    <div id="dots" class="absolute bottom-3 left-1/2 -translate-x-1/2 flex gap-2" aria-label="Indicadores" role="tablist"></div>
  </div>
</section>
<!-- ================= ¿QUIÉNES SOMOS? (simplificado) ================= -->
<section id="empresa" class="container mx-auto px-4 py-16 scroll-mt-24" aria-labelledby="empresa-title">
  <div class="relative overflow-hidden rounded-2xl bg-white shadow-lg">
    <!-- decor suave -->
    <div class="pointer-events-none absolute -top-24 -left-24 w-[420px] h-[420px] rounded-full blur-3xl opacity-20"
         style="background: radial-gradient(ellipse at center, #10b98133 0%, transparent 60%);"></div>

    <div class="grid md:grid-cols-2 gap-10 items-center p-8 md:p-12">
      <!-- Columna texto -->
      <div data-reveal>
        <span class="eyebrow">Nosotros</span>
        <h2 id="empresa-title"
            class="text-3xl md:text-4xl font-extrabold leading-tight mb-3 bg-clip-text text-transparent
                   bg-gradient-to-r from-emerald-800 to-teal-600">
          ¿Qué es Farmacia Salud y Ahorro?
        </h2>

        <p class="text-slate-700 leading-relaxed text-lg">
          Somos una farmacia cercana que ofrece productos farmacéuticos y de cuidado personal con
          <span class="font-semibold">calidad</span>, <span class="font-semibold">buen precio</span> y
          <span class="font-semibold">asesoría profesional</span>.
        </p>

        <!-- Feature cards -->
        <div class="mt-8 grid sm:grid-cols-3 gap-5">
          <!-- Ofrecemos -->
          <article class="feature-card" data-reveal>
            <div class="icon-pill" aria-hidden="true">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
                <path d="M7 17l10-10M7 7a5 5 0 000 10 5 5 0 005-5" stroke="#065f46" stroke-width="2" stroke-linecap="round"/>
                <rect x="12" y="2" width="10" height="10" rx="5" fill="#10b981" opacity=".15"/>
              </svg>
            </div>
            <h3>Ofrecemos</h3>
            <p>Medicamentos, vitaminas, dermatología y pediatría.</p>
          </article>

          <!-- Defendemos -->
          <article class="feature-card" data-reveal>
            <div class="icon-pill" aria-hidden="true">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
                <path d="M12 3l7 3v5c0 5-3.5 8-7 10-3.5-2-7-5-7-10V6l7-3z" stroke="#065f46" stroke-width="2" fill="#10b981" opacity=".12"/>
                <path d="M9.5 12l1.8 1.8L15 10" stroke="#065f46" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <h3>Defendemos</h3>
            <p>Cercanía, rapidez y precios accesibles.</p>
          </article>

          <!-- Servicios -->
          <article class="feature-card" data-reveal>
            <div class="icon-pill" aria-hidden="true">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
                <path d="M3 7h11v7H3zM14 10h4l3 3v4h-7" stroke="#065f46" stroke-width="2" fill="#10b981" opacity=".12"/>
                <circle cx="7" cy="17" r="2" stroke="#065f46" stroke-width="2"/>
                <circle cx="17" cy="17" r="2" stroke="#065f46" stroke-width="2"/>
              </svg>
            </div>
            <h3>Servicios</h3>
            <p>Entrega a domicilio y atención personalizada.</p>
          </article>
        </div>
      </div>

      <!-- Columna imagen (estática, sin tilt) -->
      <figure class="img-card" data-reveal>
        <img class="w-full h-[360px] md:h-[420px] object-cover rounded-xl"
             src="{% static 'home/img/farmacia.png' %}"
             alt="Fachada de Farmacia Salud y Ahorro">
      </figure>
    </div>
  </div>
</section>

<!-- ================= PRODUCTOS ================= -->
<section class="bg-emerald-50/50 border-y my-16 py-12 rounded-2xl shadow-lg scroll-mt-24" id="productos" aria-labelledby="productos-title">
  <div class="container mx-auto px-4">
    <h2 id="productos-title" class="sr-only">Productos</h2>

    <!-- Barra de filtros -->
    <div class="filterbar surface shadow-soft" role="group" aria-label="Búsqueda de productos" data-reveal>
      <!-- Contador (único) -->
      <div class="filter-counter">
        <span id="contador" aria-live="polite"></span>
      </div>

      <div class="filter-primary only-search">
        <!-- Buscar -->
        <div class="input-icon">
          <input id="buscador" class="input w-full" type="text" placeholder="Buscar por nombre…" autocomplete="off" />
        </div>

        <!-- Acciones -->
        <div class="filter-actions">
          <button id="limpiarFiltros" type="button" class="btn btn-ghost">Limpiar</button>
          <button id="toggleVista" type="button" class="btn btn-ghost" aria-pressed="false">Vista</button>
        </div>
      </div>

      <!-- Chips de categoría -->
      <div class="segmented" role="tablist" aria-label="Categoría">
        <input type="radio" id="seg-todos"     name="cat" value="todos"    checked>
        <label for="seg-todos">Todos</label>

        <input type="radio" id="seg-marca"     name="cat" value="marca">
        <label for="seg-marca">Marca</label>

        <input type="radio" id="seg-generico"  name="cat" value="generico">
        <label for="seg-generico">Genérico</label>

        <input type="radio" id="seg-topico"    name="cat" value="topico">
        <label for="seg-topico">Tópico</label>

        <input type="radio" id="seg-inyectado" name="cat" value="inyectado">
        <label for="seg-inyectado">Inyectado</label>
      </div>
    </div>

    <!-- Grid de productos -->
    <div id="gridProductos" class="grid sm:grid-cols-2 lg:grid-cols-4 gap-6" data-reveal>
      <!-- MARCA -->
      <article class="producto-card" data-cat="marca" data-nombre="Loratadina MK" data-precio="214.70"
               data-desc="Antihistamínico no sedante para rinitis y alergias. Alivia estornudos y picazón.">
        <div class="bg-white rounded-xl shadow-soft p-5 flex flex-col items-center h-full">
          <span class="badge mb-2">Marca</span>
          <img src="{% static 'home/img/loratadina.png' %}" alt="Loratadina MK" class="h-20 object-contain mb-2" loading="lazy">
          <h3 class="font-bold text-emerald-700 text-center mb-1">Loratadina MK</h3>
          <p class="text-slate-700 text-sm mb-2" aria-label="Precio">Q214.70</p>
        </div>
      </article>

      <article class="producto-card" data-cat="marca" data-nombre="Aligrip" data-precio="46.45"
               data-desc="Alivio de síntomas de resfriado y gripe: congestión, dolor de cabeza y fiebre.">
        <div class="bg-white rounded-xl shadow-soft p-5 flex flex-col items-center h-full">
          <span class="badge mb-2">Marca</span>
          <img src="{% static 'home/img/Aligrip.png' %}" alt="Aligrip" class="h-20 object-contain mb-2" loading="lazy">
          <h3 class="font-bold text-emerald-700 text-center mb-1">Aligrip</h3>
          <p class="text-slate-700 text-sm mb-2" aria-label="Precio">Q46.45</p>
        </div>
      </article>

      <article class="producto-card" data-cat="marca" data-nombre="Ginna 0.02G" data-precio="240.45"
               data-desc="Anticonceptivo oral de baja dosis. Uso diario; consulta siempre con profesional de salud.">
        <div class="bg-white rounded-xl shadow-soft p-5 flex flex-col items-center h-full">
          <span class="badge mb-2">Marca</span>
          <img src="{% static 'home/img/ginna.png' %}" alt="Ginna 0.02G" class="h-20 object-contain mb-2" loading="lazy">
          <h3 class="font-bold text-emerald-700 text-center mb-1">Ginna 0.02G</h3>
          <p class="text-slate-700 text-sm mb-2" aria-label="Precio">Q240.45</p>
        </div>
      </article>

      <article class="producto-card" data-cat="marca" data-nombre="Besic Derm 150mg" data-precio="102.91"
               data-desc="Cápsula antifúngica 150 mg. Apoya el tratamiento de infecciones por hongos.">
        <div class="bg-white rounded-xl shadow-soft p-5 flex flex-col items-center h-full">
          <span class="badge mb-2">Marca</span>
          <img src="{% static 'home/img/Besic Derm.png' %}" alt="Besic Derm 150mg" class="h-20 object-contain mb-2" loading="lazy">
          <h3 class="font-bold text-emerald-700 text-center mb-1">Besic Derm 150mg</h3>
          <p class="text-slate-700 text-sm mb-2" aria-label="Precio">Q102.91</p>
        </div>
      </article>

      <article class="producto-card" data-cat="marca" data-nombre="Colageina Advance" data-precio="265.25"
               data-desc="Suplemento de colágeno con vitaminas. Apoya articulaciones, piel, cabello y uñas.">
        <div class="bg-white rounded-xl shadow-soft p-5 flex flex-col items-center h-full">
          <span class="badge mb-2">Marca</span>
          <img src="{% static 'home/img/colageina.png' %}" alt="Colageina Advance" class="h-20 object-contain mb-2" loading="lazy">
          <h3 class="font-bold text-emerald-700 text-center mb-1">Colageina Advance</h3>
          <p class="text-slate-700 text-sm mb-2" aria-label="Precio">Q265.25</p>
        </div>
      </article>

      <!-- GENÉRICOS -->
      <article class="producto-card" data-cat="generico" data-nombre="Clotriplex 12.5G" data-precio="9.58"
               data-desc="Crema antimicótica. Ayuda en pie de atleta y otras micosis cutáneas.">
        <div class="bg-white rounded-xl shadow-soft p-5 flex flex-col items-center h-full">
          <span class="badge mb-2">Genérico</span>
          <img src="{% static 'home/img/clotriplex.png' %}" alt="Clotriplex 12.5G" class="h-20 object-contain mb-2" loading="lazy">
          <h3 class="font-bold text-emerald-700 text-center mb-1">Clotriplex 12.5G</h3>
          <p class="text-slate-700 text-sm mb-2" aria-label="Precio">Q9.58</p>
        </div>
      </article>

      <article class="producto-card" data-cat="generico" data-nombre="Gencloben 30G" data-precio="19.00"
               data-desc="Crema combinada para irritaciones cutáneas: antiinflamatoria, antifúngica y antibacteriana.">
        <div class="bg-white rounded-xl shadow-soft p-5 flex flex-col items-center h-full">
          <span class="badge mb-2">Genérico</span>
          <img src="{% static 'home/img/gencloben.png' %}" alt="Gencloben 30G" class="h-20 object-contain mb-2" loading="lazy">
          <h3 class="font-bold text-emerald-700 text-center mb-1">Gencloben 30G</h3>
          <p class="text-slate-700 text-sm mb-2" aria-label="Precio">Q19.00</p>
        </div>
      </article>

      <article class="producto-card" data-cat="generico" data-nombre="Acetaminofén 500mg (unidad)" data-precio="3.20"
               data-desc="Analgésico y antipirético. Alivia dolor leve a moderado y fiebre.">
        <div class="bg-white rounded-xl shadow-soft p-5 flex flex-col items-center h-full">
          <span class="badge mb-2">Genérico</span>
          <img src="{% static 'home/img/acetaminofen.png' %}" alt="Acetaminofén 500mg (unidad)" class="h-20 object-contain mb-2" loading="lazy">
          <h3 class="font-bold text-emerald-700 text-center mb-1">Acetaminofén 500mg (unidad)</h3>
          <p class="text-slate-700 text-sm mb-2" aria-label="Precio">Q3.20</p>
        </div>
      </article>

      <article class="producto-card" data-cat="generico" data-nombre="Vitamina C 500mg" data-precio="43.60"
               data-desc="Antioxidante. Contribuye a la función inmunológica y al cuidado general.">
        <div class="bg-white rounded-xl shadow-soft p-5 flex flex-col items-center h-full">
          <span class="badge mb-2">Genérico</span>
          <img src="{% static 'home/img/vitaminac.png' %}" alt="Vitamina C 500mg" class="h-20 object-contain mb-2" loading="lazy">
          <h3 class="font-bold text-emerald-700 text-center mb-1">Vitamina C 500mg</h3>
          <p class="text-slate-700 text-sm mb-2" aria-label="Precio">Q43.60</p>
        </div>
      </article>

      <article class="producto-card" data-cat="generico" data-nombre="Ibuprofeno 400mg (unidad)" data-precio="2.05"
               data-desc="Antiinflamatorio no esteroideo. Para dolor, inflamación y fiebre.">
        <div class="bg-white rounded-xl shadow-soft p-5 flex flex-col items-center h-full">
          <span class="badge mb-2">Genérico</span>
          <img src="{% static 'home/img/ibuprofeno.png' %}" alt="Ibuprofeno 400mg (unidad)" class="h-20 object-contain mb-2" loading="lazy">
          <h3 class="font-bold text-emerald-700 text-center mb-1">Ibuprofeno 400mg (unidad)</h3>
          <p class="text-slate-700 text-sm mb-2" aria-label="Precio">Q2.05</p>
        </div>
      </article>

      <!-- TÓPICOS -->
      <article class="producto-card" data-cat="topico" data-nombre="Canesten Extra 15G" data-precio="86.21"
               data-desc="Crema antimicótica para afecciones como candidiasis y pie de atleta.">
        <div class="bg-white rounded-xl shadow-soft p-5 flex flex-col items-center h-full">
          <span class="badge mb-2">Tópico</span>
          <img src="{% static 'home/img/canesten.png' %}" alt="Canesten Extra 15G" class="h-20 object-contain mb-2" loading="lazy">
          <h3 class="font-bold text-emerald-700 text-center mb-1">Canesten Extra 15G</h3>
          <p class="text-slate-700 text-sm mb-2" aria-label="Precio">Q86.21</p>
        </div>
      </article>

      <article class="producto-card" data-cat="topico" data-nombre="Flamygel 30G" data-precio="54.11"
               data-desc="Hidrogel para quemaduras y heridas menores. Refresca y favorece la cicatrización.">
        <div class="bg-white rounded-xl shadow-soft p-5 flex flex-col items-center h-full">
          <span class="badge mb-2">Tópico</span>
          <img src="{% static 'home/img/flamygel.png' %}" alt="Flamygel 30G" class="h-20 object-contain mb-2" loading="lazy">
          <h3 class="font-bold text-emerald-700 text-center mb-1">Flamygel 30G</h3>
          <p class="text-slate-700 text-sm mb-2" aria-label="Precio">Q54.11</p>
        </div>
      </article>

      <article class="producto-card" data-cat="topico" data-nombre="Clevium 30G" data-precio="78.75"
               data-desc="Crema tópica para irritaciones y comezón de la piel. Uso externo.">
        <div class="bg-white rounded-xl shadow-soft p-5 flex flex-col items-center h-full">
          <span class="badge mb-2">Tópico</span>
          <img src="{% static 'home/img/Clevium.jpg' %}" alt="Clevium 30G" class="h-20 object-contain mb-2" loading="lazy">
          <h3 class="font-bold text-emerald-700 text-center mb-1">Clevium 30G</h3>
          <p class="text-slate-700 text-sm mb-2" aria-label="Precio">Q78.75</p>
        </div>
      </article>

      <article class="producto-card" data-cat="topico" data-nombre="Gel Árnica y Manzanilla 120mg" data-precio="18.95"
               data-desc="Gel calmante. Ayuda con golpes, tensión muscular y fatiga localizada.">
        <div class="bg-white rounded-xl shadow-soft p-5 flex flex-col items-center h-full">
          <span class="badge mb-2">Tópico</span>
          <img src="{% static 'home/img/gelarnica.png' %}" alt="Gel Árnica y Manzanilla 120mg" class="h-20 object-contain mb-2" loading="lazy">
          <h3 class="font-bold text-emerald-700 text-center mb-1">Gel Árnica y Manzanilla 120mg</h3>
          <p class="text-slate-700 text-sm mb-2" aria-label="Precio">Q18.95</p>
        </div>
      </article>

      <article class="producto-card" data-cat="topico" data-nombre="Diclofenaco Gel Tópico 20G" data-precio="11.05"
               data-desc="Gel antiinflamatorio y analgésico para músculos y articulaciones.">
        <div class="bg-white rounded-xl shadow-soft p-5 flex flex-col items-center h-full">
          <span class="badge mb-2">Tópico</span>
          <img src="{% static 'home/img/diclofenaco.png' %}" alt="Diclofenaco Gel Tópico 20G" class="h-20 object-contain mb-2" loading="lazy">
          <h3 class="font-bold text-emerald-700 text-center mb-1">Diclofenaco Gel Tópico 20G</h3>
          <p class="text-slate-700 text-sm mb-2" aria-label="Precio">Q11.05</p>
        </div>
      </article>

      <!-- INYECTADOS -->
      <article class="producto-card" data-cat="inyectado" data-nombre="Dexa Bioplexin 2ml" data-precio="75.50"
               data-desc="Dexametasona inyectable. Corticoide de acción antiinflamatoria (uso indicado por médico).">
        <div class="bg-white rounded-xl shadow-soft p-5 flex flex-col items-center h-full">
          <span class="badge mb-2">Inyectado</span>
          <img src="{% static 'home/img/dexabioplexin.jpg' %}" alt="Dexa Bioplexin 2ml" class="h-20 object-contain mb-2" loading="lazy">
          <h3 class="font-bold text-emerald-700 text-center mb-1">Dexa Bioplexin 2ml</h3>
          <p class="text-slate-700 text-sm mb-2" aria-label="Precio">Q75.50</p>
        </div>
      </article>

      <article class="producto-card" data-cat="inyectado" data-nombre="Rofemed 1G" data-precio="100.00"
               data-desc="Antibiótico inyectable. Apoyo en el tratamiento de infecciones bajo supervisión médica.">
        <div class="bg-white rounded-xl shadow-soft p-5 flex flex-col items-center h-full">
          <span class="badge mb-2">Inyectado</span>
          <img src="{% static 'home/img/rofemed.jpg' %}" alt="Rofemed 1G" class="h-20 object-contain mb-2" loading="lazy">
          <h3 class="font-bold text-emerald-700 text-center mb-1">Rofemed 1G</h3>
          <p class="text-slate-700 text-sm mb-2" aria-label="Precio">Q100.00</p>
        </div>
      </article>

      <article class="producto-card" data-cat="inyectado" data-nombre="Viro Grip Doble Terapia" data-precio="22.05"
               data-desc="Alivio de síntomas de gripe y resfriado: congestión, dolor y fiebre.">
        <div class="bg-white rounded-xl shadow-soft p-5 flex flex-col items-center h-full">
          <span class="badge mb-2">Inyectado</span>
          <img src="{% static 'home/img/virogrip.png' %}" alt="Viro Grip Doble Terapia" class="h-20 object-contain mb-2" loading="lazy">
          <h3 class="font-bold text-emerald-700 text-center mb-1">Viro Grip Doble Terapia</h3>
          <p class="text-slate-700 text-sm mb-2" aria-label="Precio">Q22.05</p>
        </div>
      </article>

      <article class="producto-card" data-cat="inyectado" data-nombre="Axtar 0.5G" data-precio="396.80"
               data-desc="Antibiótico inyectable de amplio espectro. Uso y dosificación por indicación médica.">
        <div class="bg-white rounded-xl shadow-soft p-5 flex flex-col items-center h-full">
          <span class="badge mb-2">Inyectado</span>
          <img src="{% static 'home/img/Axtar.jpg' %}" alt="Axtar 0.5G" class="h-20 object-contain mb-2" loading="lazy">
          <h3 class="font-bold text-emerald-700 text-center mb-1">Axtar 0.5G</h3>
          <p class="text-slate-700 text-sm mb-2" aria-label="Precio">Q396.80</p>
        </div>
      </article>

      <article class="producto-card" data-cat="inyectado" data-nombre="Mesigyna Instayec 1 Ampolla" data-precio="144.50"
               data-desc="Anticonceptivo inyectable mensual. Administración y seguimiento por profesional de salud.">
        <div class="bg-white rounded-xl shadow-soft p-5 flex flex-col items-center h-full">
          <span class="badge mb-2">Inyectado</span>
          <img src="{% static 'home/img/mesigyna.jpg' %}" alt="Mesigyna Instayec 1 Ampolla" class="h-20 object-contain mb-2" loading="lazy">
          <h3 class="font-bold text-emerald-700 text-center mb-1">Mesigyna Instayec 1 Ampolla</h3>
          <p class="text-slate-700 text-sm mb-2" aria-label="Precio">Q144.50</p>
        </div>
      </article>
    </div>
  </div>
</section>

<!-- Volver arriba -->
<a href="#hero" class="fixed right-4 bottom-4 btn btn-ghost shadow-soft z-10" aria-label="Volver arriba">↑</a>

<!-- ================= JS: Carrusel + Catálogo ================= -->
<script>
(function(){
  /* === Carrusel === */
  const root = document.getElementById('slider');
  const slides = root ? Array.from(root.querySelectorAll('[data-slide]')) : [];
  const nextBtn = document.getElementById('next');
  const prevBtn = document.getElementById('prev');
  const dotsWrap = document.getElementById('dots');

  if (slides.length && nextBtn && prevBtn && dotsWrap){
    let idx=0, timer=null;

    slides.forEach((_,i)=>{
      const b=document.createElement('button');
      b.className='w-2.5 h-2.5 rounded-full bg-white/60 hover:bg-white transition';
      b.setAttribute('role','tab');
      b.setAttribute('aria-label','Ir al slide ' + (i+1));
      b.addEventListener('click',()=>go(i,true));
      dotsWrap.appendChild(b);
    });

    function paint(){
      slides.forEach((s,i)=>{
        const active = i===idx;
        s.style.opacity = active ? 1 : 0;
        s.setAttribute('aria-hidden', String(!active));
      });
      Array.from(dotsWrap.children).forEach((d,i)=>{
        d.style.background = i===idx ? '#10B981' : 'rgba(255,255,255,.6)';
      });
    }
    function go(n,manual=false){
      idx=(n+slides.length)%slides.length; paint();
      if(manual){ restart(); }
    }
    function step(){ go(idx+1); }
    function restart(){ clearInterval(timer); timer=setInterval(step,5000); }

    nextBtn.addEventListener('click',()=>go(idx+1,true));
    prevBtn.addEventListener('click',()=>go(idx-1,true));
    root.addEventListener('keydown', (e)=>{
      if(e.key==='ArrowRight') go(idx+1,true);
      if(e.key==='ArrowLeft') go(idx-1,true);
    });
    root.addEventListener('mouseenter', ()=>clearInterval(timer));
    root.addEventListener('mouseleave', restart);

    restart(); paint();
  }

  /* === Catálogo: buscar + chips + vista + limpiar === */
  const grid        = document.getElementById('gridProductos');
  const cards       = grid ? Array.from(grid.children) : [];
  const buscador    = document.getElementById('buscador');
  const contador    = document.getElementById('contador');
  const segRadios   = document.querySelectorAll('.segmented input[name="cat"]');
  const toggleVista = document.getElementById('toggleVista');
  const limpiar     = document.getElementById('limpiarFiltros');

  // Crear info (chips) + descripción; se muestran SOLO en Vista por CSS
  function ensureInfo(card){
    const wrap  = card.querySelector('div');
    if (!wrap) return;

    if (!card.querySelector('.prod-info')){
      const name  = (wrap.querySelector('h3')?.textContent || '').trim();
      const price = (wrap.querySelector('[aria-label="Precio"]')?.textContent || '').trim();
      const cat   = (wrap.querySelector('.badge')?.textContent || card.dataset.cat || '').trim();
      const m = name.match(/(\d+(?:[.,]\d+)?\s*(?:mg|g|G|ml|mL|unidad|Ampolla))/);
      const present = m ? m[1].replace(',', '.') : '—';
      const info = document.createElement('div');
      info.className = 'prod-info';
      info.innerHTML = `
        <span class="mini">${cat}</span>
        <span class="mini">Precio: ${price}</span>
        <span class="mini">Presentación: ${present}</span>
      `;
      wrap.appendChild(info);
    }

    if (!card.querySelector('.prod-desc')){
      const p = document.createElement('p');
      p.className = 'prod-desc';
      p.textContent = card.dataset.desc || 'Descripción breve del producto.';
      wrap.appendChild(p);
    }
  }
  cards.forEach(ensureInfo);

  function normalizar(str){ return (str||'').toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu,''); }
  function catSeleccionada(){ const r = document.querySelector('.segmented input[name="cat"]:checked'); return r ? r.value : 'todos'; }

  function aplicar(){
    const term = normalizar(buscador?.value || '');
    const cat  = catSeleccionada();
    let visibles = [];
    cards.forEach(card=>{
      const name = normalizar(card.dataset.nombre || '');
      const okText = !term || name.includes(term);
      const okCat  = cat === 'todos' || (card.dataset.cat === cat);
      const show = okText && okCat;
      card.style.display = show ? '' : 'none';
      if (show) visibles.push(card);
    });
    if (contador) contador.textContent = `${visibles.length} producto${visibles.length===1?'':'s'} encontrados`;
  }

  buscador?.addEventListener('input', aplicar);
  segRadios.forEach(r => r.addEventListener('change', aplicar));

  function updateVistaButton(){
    const isList = grid.classList.contains('list-view');
    toggleVista?.setAttribute('aria-pressed', String(isList));
    if (toggleVista) toggleVista.textContent = isList ? 'Grid' : 'Vista';
  }
  toggleVista?.addEventListener('click', ()=>{
    grid.classList.toggle('list-view');   // Vista = lista (muestra info+desc por CSS)
    updateVistaButton();
  });

  // Limpiar sin cambiar modo actual
  limpiar?.addEventListener('click', ()=>{
    if (buscador) buscador.value = '';
    const segTodos = document.getElementById('seg-todos');
    if (segTodos) segTodos.checked = true;
    aplicar();
  });

  // Arranca SIEMPRE en Grid (sin info)
  grid?.classList.remove('list-view');
  updateVistaButton();

  // Reveal suave
  const revealEls = document.querySelectorAll('[data-reveal]');
  if ('IntersectionObserver' in window){
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{ if (e.isIntersecting){ e.target.classList.add('reveal-in'); io.unobserve(e.target); } });
    }, { threshold: 0.12 });
    revealEls.forEach(el => io.observe(el));
  } else {
    revealEls.forEach(el => el.classList.add('reveal-in'));
  }

  aplicar();
})();
</script>
{% endblock %}
