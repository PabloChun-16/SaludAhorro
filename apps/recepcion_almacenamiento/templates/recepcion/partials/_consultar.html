{% load static %}

<link rel="stylesheet" href="{% static 'consult/consult.css' %}?v=13">

<style>
  /* ====== MODAL ====== */
  .saif-modal .modal-content{
    border:0;border-radius:18px;overflow:hidden;
    box-shadow:0 18px 45px rgba(14,122,58,.25);
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  }
  .saif-modal .modal-header{
    background:#0f7a3a;color:#fff;border-bottom:0;padding:.9rem 1.1rem;
  }
  .saif-modal .modal-footer{border-top:0;background:#fff;}
  .saif-modal .modal-body{
    background:#f7fbf9;padding:1rem 1.1rem;
    max-height:72vh; overflow:auto;
  }

  /* ====== TOP STATS ====== */
  .stats{
    display:grid;gap:.9rem;
    grid-template-columns: repeat(4, 1fr);
  }
  @media (max-width: 992px){ .stats{ grid-template-columns: 1fr 1fr; } }
  @media (max-width: 576px){ .stats{ grid-template-columns: 1fr; } }

  .stat{
    display:flex;gap:.75rem;align-items:flex-start;background:#fff;
    border:1px solid #e5e7eb;border-radius:14px;padding:.85rem .95rem;
    box-shadow:0 6px 16px rgba(15,23,42,.06);
  }
  .stat .ico{
    flex:0 0 36px;height:36px;width:36px;border-radius:10px;
    display:flex;align-items:center;justify-content:center;
    background:#ecfdf5;color:#0E7A3A;border:1px solid #a7f3d0;font-size:1.05rem;
  }
  .stat .lbl{font-weight:800;color:#0b1220;margin-top:.1rem;}
  .stat .val{color:#111827;margin-top:.1rem;word-break:break-word;line-height:1.35;}
  .chip-est{
    display:inline-flex;align-items:center;gap:.35rem;padding:.24rem .55rem;border-radius:999px;
    font-weight:700;font-size:.82rem;border:1px solid transparent;
  }
  .chip--ok{background:#ecfdf5;color:#065f46;border-color:#a7f3d0;}
  .chip--warn{background:#fff7ed;color:#92400e;border-color:#fed7aa;}
  .chip--bad{background:#fef2f2;color:#991b1b;border-color:#fecaca;}
  .chip--neutral{background:#f3f4f6;color:#374151;border-color:#e5e7eb;}

  /* ====== BLOQUES ====== */
  .block{
    background:#fff;border:1px solid #e5e7eb;border-radius:14px;
    box-shadow:0 8px 18px rgba(15,23,42,.06);
  }
  .block-header{
    padding:.75rem .95rem;border-bottom:1px solid #eef2f7;font-weight:800;color:#0b1220;
    display:flex;align-items:center;gap:.5rem;
  }
  .block-body{padding:.8rem .9rem;}

  /* ====== TABLA: thead VERDE ====== */
  .table thead th{
    background:#e8f5ec !important;
    color:#0b3f2e;
    border-bottom:1px solid #d7dbdf !important;
  }
</style>

<div class="saif-modal">
  <!-- Header -->
  <div class="modal-header">
    <div class="saif-modal-title">
      <span class="saif-modal-icon"><i class="bi bi-box-arrow-in-down"></i></span>
      <span>Detalle de Recepción</span>
    </div>
    <span class="saif-badge">SAIF</span>
  </div>

  <!-- Body -->
  <div class="modal-body">
    <!-- ===== Top stats (nuevo orden) ===== -->
    <div class="stats mb-3">
      <!-- Estado -->
      <div class="stat">
        <div class="ico"><i class="bi bi-flag"></i></div>
        <div>
          <div class="lbl">Estado</div>
          <div class="val">
            {% with est=recepcion.estado_recepcion|lower %}
              {% if est == "completado" %}
                <span class="chip-est chip--ok"><i class="bi bi-check2-circle"></i> Completado</span>
              {% elif est == "pendiente" %}
                <span class="chip-est chip--warn"><i class="bi bi-hourglass-split"></i> Pendiente</span>
              {% elif est == "anulado" %}
                <span class="chip-est chip--bad"><i class="bi bi-x-circle"></i> Anulado</span>
              {% else %}
                <span class="chip-est chip--neutral"><i class="bi bi-question-circle"></i> {{ recepcion.estado_recepcion|default:"Desconocido" }}</span>
              {% endif %}
            {% endwith %}
          </div>
        </div>
      </div>

      <!-- Usuario -->
      <div class="stat">
        <div class="ico"><i class="bi bi-person-circle"></i></div>
        <div>
          <div class="lbl">Usuario</div>
          <div class="val">{{ recepcion.id_usuario|default:"—" }}</div>
        </div>
      </div>

      <!-- Fecha -->
      <div class="stat">
        <div class="ico"><i class="bi bi-calendar-event"></i></div>
        <div>
          <div class="lbl">Fecha Recepción</div>
          <div class="val">{{ recepcion.fecha_recepcion|date:"d/m/Y H:i" }}</div>
        </div>
      </div>

      <!-- Número de Envío -->
      <div class="stat">
        <div class="ico"><i class="bi bi-upc-scan"></i></div>
        <div>
          <div class="lbl">N.º de Envío</div>
          <div class="val">{{ recepcion.numero_envio_bodega|default:"—" }}</div>
        </div>
      </div>
    </div>

    <!-- ===== Comentario (full width si existe) ===== -->
    {% if comentario %}
    <div class="block mb-3">
      <div class="block-header"><i class="bi bi-chat-dots"></i> Comentario</div>
      <div class="block-body">{{ comentario }}</div>
    </div>
    {% endif %}

    <!-- ===== Productos Recibidos (tabla con thead verde) ===== -->
    <div class="block">
      <div class="block-header"><i class="bi bi-box"></i> Productos Recibidos</div>
      <div class="block-body">
        <div class="table-responsive">
          <table class="table table-bordered align-middle text-center">
            <thead>
              <tr>
                <th>Código</th>
                <th>Producto</th>
                <th>Lote</th>
                <th>Fecha Caducidad</th>
                <th>Cantidad</th>
                <th>Costo Unit.</th>
              </tr>
            </thead>
            <tbody>
              {% for d in detalles %}
              <tr>
                <td>{{ d.id_lote.id_producto.codigo_producto }}</td>
                <td class="text-start">{{ d.id_lote.id_producto.nombre }}</td>
                <td>{{ d.id_lote.numero_lote }}</td>
                <td>{{ d.id_lote.fecha_caducidad|date:"d/m/Y" }}</td>
                <td>{{ d.cantidad_recibida }}</td>
                <td>{{ d.costo_unitario }}</td>
              </tr>
              {% empty %}
              <tr><td colspan="6" class="text-muted">Sin detalles</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <div class="text-end fw-bold mt-2">Total (estimado): {{ total }}</div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="modal-footer py-2">
    <button type="button" class="btn btn-light saif-btn-light" data-bs-dismiss="modal">
      <i class="bi bi-x-lg"></i> Cerrar
    </button>
  </div>
</div>
