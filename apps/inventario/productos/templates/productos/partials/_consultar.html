{% load static %}

<link rel="stylesheet" href="{% static 'consult/consult.css' %}?v=12">

<style>
  /* ====== LAYOUT GENERAL DEL MODAL ====== */
  .saif-modal .modal-content{
    border:0;border-radius:18px;overflow:hidden;
    box-shadow:0 18px 45px rgba(14,122,58,.25);
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  }
  .saif-modal .modal-header{
    background:#0f7a3a;color:#fff;border-bottom:0;padding:.9rem 1.1rem;
  }
  .saif-modal .modal-footer{border-top:0;background:#fff;}
  /* Altura visible: el contenido nunca se corta */
  .saif-modal .modal-body{
    background:#f7fbf9;padding:1rem 1.1rem;
    max-height:72vh; overflow:auto;   /* <- scroll interno */
  }

  /* ====== GRID PRINCIPAL (2 columnas) ====== */
  .product-layout{
    display:grid; gap:1rem 1.2rem;
    grid-template-columns: 320px 1fr;          /* izquierda fija + derecha fluida */
  }
  @media (max-width: 992px){
    .product-layout{ grid-template-columns: 1fr; }
  }

  /* ====== COLUMNA IZQUIERDA: imagen + chips ====== */
  .p-card{background:#fff;border:1px solid #e5e7eb;border-radius:14px;overflow:hidden;
    box-shadow:0 8px 18px rgba(15,23,42,.06);}
  .p-media{padding:.65rem;border-bottom:1px solid #eef2f7;}
  .p-media img{width:100%;height:240px;object-fit:cover;border-radius:10px;display:block;}
  .p-meta{display:flex;flex-wrap:wrap;gap:.35rem .45rem;padding:.65rem .75rem .8rem;}
  .chip{display:inline-flex;align-items:center;gap:.35rem;padding:.25rem .6rem;border-radius:999px;
    font-size:.8rem;line-height:1;background:#f3f4f6;color:#4b5563;border:1px solid #e5e7eb;font-weight:600;}
  .chip--success{background:#ecfdf5;color:#065f46;border-color:#a7f3d0;}
  .chip--danger{background:#fef2f2;color:#991b1b;border-color:#fecaca;}
  .chip--primary{background:#eff6ff;color:#1d4ed8;border-color:#bfdbfe;}
  .chip--dark{background:#111827;color:#fff;border-color:#111827;}

  /* ====== COLUMNA DERECHA: campos en pares ====== */
  .dv2{ row-gap:1rem; }
  .dv2 .col-gap{ padding-right:.5rem; padding-left:.5rem; }

  .dv2-field{
    display:flex;align-items:flex-start;gap:.65rem;background:#fff;
    border:1px solid #e5e7eb;border-radius:14px;padding:.8rem .95rem;min-height:60px;
    box-shadow:0 4px 12px rgba(15,23,42,.05);
  }
  .dv2-ico{flex:0 0 22px;width:22px;text-align:center;opacity:.9;line-height:1.2;font-size:1rem;margin-top:.1rem;}
  .dv2-body{min-width:0;}
  .dv2-label{font-weight:800;color:#0b1220;margin-bottom:.15rem;}
  .dv2-value{color:#111827;word-break:break-word;line-height:1.35;}
  .--empty{color:#64748b;font-style:italic;}
  /* grid de pares */
  @media (min-width:768px){
    .dv2 .pair{ width:50%; float:left; }
    .dv2 .full{ width:100%; float:left; }
  }
  @media (max-width:767.98px){
    .dv2 .pair, .dv2 .full{ width:100%; }
  }

  /* ====== BADGE tipo “rol” opcional debajo de la imagen ====== */
  .role-badge{
    display:inline-flex;align-items:center;gap:.35rem;background:#ecfdf5;border:1px solid #a7f3d0;color:#065f46;
    padding:.28rem .6rem;border-radius:999px;font-weight:700;font-size:.85rem;margin:.4rem .75rem .85rem;
  }
</style>

<div class="saif-modal">
  <!-- Header -->
  <div class="modal-header">
    <div class="saif-modal-title">
      <span class="saif-modal-icon"><i class="bi bi-box-seam"></i></span>
      <span>Detalle de Producto</span>
    </div>
    <span class="saif-badge">SAIF</span>
    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
  </div>

  <!-- Body -->
  <div class="modal-body">
    <div class="product-layout">

      <!-- Columna Izquierda -->
      <div>
        <div class="p-card">
          <div class="p-media">
            {% if producto.imagen_url %}
              <img src="{{ producto.imagen_url.url }}" alt="Imagen de {{ producto.nombre|default:'Producto' }}">
            {% else %}
              <img src="{% static 'home/img/no-image.png' %}" alt="Sin imagen disponible">
            {% endif %}
          </div>

          <!-- Chips de estado -->
          <div class="p-meta">
            {% with estado=producto.id_estado_producto.nombre_estado %}
              {% if estado == "Activo" %}
                <span class="chip chip--success"><i class="bi bi-check2-circle"></i> Activo</span>
              {% elif estado == "Inactivo" %}
                <span class="chip chip--danger"><i class="bi bi-x-circle"></i> Inactivo</span>
              {% else %}
                <span class="chip"><i class="bi bi-dash-circle"></i> {{ estado|default:"Sin estado" }}</span>
              {% endif %}
            {% endwith %}

            <span class="chip chip--dark"><i class="bi bi-graph-down-arrow"></i> Stock mín. {{ producto.stock_minimo|default:"0" }}</span>

            {% if producto.requiere_receta %}
              <span class="chip chip--primary"><i class="bi bi-clipboard2-pulse"></i> Receta: Sí</span>
            {% else %}
              <span class="chip"><i class="bi bi-clipboard2-x"></i> Receta: No</span>
            {% endif %}

            {% if producto.es_controlado %}
              <span class="chip chip--danger"><i class="bi bi-shield-exclamation"></i> Controlado: Sí</span>
            {% else %}
              <span class="chip"><i class="bi bi-shield"></i> Controlado: No</span>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Columna Derecha (pares + bloques) -->
      <div>
        <div class="dv2 clearfix">

          <!-- Par: Código / Nombre -->
          <div class="pair col-gap">
            <div class="dv2-field">
              <i class="bi bi-upc-scan dv2-ico"></i>
              <div class="dv2-body">
                <div class="dv2-label">Código</div>
                <div class="dv2-value {{ producto.codigo_producto|default:''|yesno:',--empty' }}">
                  {{ producto.codigo_producto|default:"—" }}
                </div>
              </div>
            </div>
          </div>

          <div class="pair col-gap">
            <div class="dv2-field">
              <i class="bi bi-tag dv2-ico"></i>
              <div class="dv2-body">
                <div class="dv2-label">Nombre</div>
                <div class="dv2-value text-capitalize {{ producto.nombre|default:''|yesno:',--empty' }}">
                  {{ producto.nombre|default:"—" }}
                </div>
              </div>
            </div>
          </div>

          <!-- Par: Laboratorio / Presentación -->
          <div class="pair col-gap">
            <div class="dv2-field">
              <i class="bi bi-buildings dv2-ico"></i>
              <div class="dv2-body">
                <div class="dv2-label">Laboratorio</div>
                <div class="dv2-value {{ producto.id_laboratorio.nombre_laboratorio|default:''|yesno:',--empty' }}">
                  {{ producto.id_laboratorio.nombre_laboratorio|default:"—" }}
                </div>
              </div>
            </div>
          </div>

          <div class="pair col-gap">
            <div class="dv2-field">
              <i class="bi bi-box dv2-ico"></i>
              <div class="dv2-body">
                <div class="dv2-label">Presentación</div>
                <div class="dv2-value {{ producto.id_presentacion.nombre_presentacion|default:''|yesno:',--empty' }}">
                  {{ producto.id_presentacion.nombre_presentacion|default:"—" }}
                </div>
              </div>
            </div>
          </div>

          <!-- Par: Unidad de Medida / (espacio para futuro par) -->
       <!-- Bloque: Unidad de Medida (a lo ancho) -->
<div class="full col-gap">
  <div class="dv2-field">
    <i class="bi bi-rulers dv2-ico"></i>
    <div class="dv2-body">
      <div class="dv2-label">Unidad de Medida</div>
      <div class="dv2-value {{ producto.id_unidad_medida.nombre_unidad|default:''|yesno:',--empty' }}">
        {{ producto.id_unidad_medida.nombre_unidad|default:"—" }}
      </div>
    </div>
  </div>
</div>


          <div class="pair col-gap">
            <!-- libre por si luego agregas otro dato (SKU, Marca, etc.) -->
          </div>

          <!-- Bloque: Descripción -->
          <div class="full col-gap">
            <div class="dv2-field">
              <i class="bi bi-card-text dv2-ico"></i>
              <div class="dv2-body">
                <div class="dv2-label">Descripción</div>
                <div class="dv2-value {{ producto.descripcion|default:''|yesno:',--empty' }}">
                  {{ producto.descripcion|default:"—" }}
                </div>
              </div>
            </div>
          </div>

          <!-- Bloque: Condición de Almacenamiento -->
          <div class="full col-gap">
            <div class="dv2-field">
              <i class="bi bi-thermometer-half dv2-ico"></i>
              <div class="dv2-body">
                <div class="dv2-label">Condición de Almacenamiento</div>
                <div class="dv2-value {{ producto.id_condicion_almacenamiento.nombre_condicion|default:''|yesno:',--empty' }}">
                  {{ producto.id_condicion_almacenamiento.nombre_condicion|default:"—" }}
                </div>
              </div>
            </div>
          </div>

        </div><!-- /.dv2 -->
      </div>

    </div><!-- /.product-layout -->
  </div>

  <!-- Footer -->
  <div class="modal-footer py-2">
    <button type="button" class="btn btn-light saif-btn-light" data-bs-dismiss="modal">
      <i class="bi bi-x-lg"></i> Cerrar
    </button>
  </div>
</div>
