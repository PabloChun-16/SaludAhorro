{% load static %}

<link rel="stylesheet" href="{% static 'form/form.css' %}">


<div class="saif-modal">
  <div class="modal-header">
    <div class="saif-modal-title">
      <span class="saif-modal-icon"><i class="bi bi-person-badge"></i></span>
      <span>{{ titulo|default:"Nuevo Usuario" }}</span>
    </div>
    <span class="saif-badge">SAIF</span>
    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
  </div>

  <form method="post" id="form-usuario" action="{{ action }}" novalidate autocomplete="off">
    <div class="modal-body">
      {% csrf_token %}
      <div class="container-fluid">
        <div class="row g-3">

          <div class="col-12 col-md-6">
            <label class="form-label mb-1" for="{{ form.nombre.id_for_label }}">Nombre</label>
            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-person"></i></span>
              {{ form.nombre }}
            </div>
            {% for e in form.nombre.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
          </div>

          <div class="col-12 col-md-6">
            <label class="form-label mb-1" for="{{ form.apellido.id_for_label }}">Apellido</label>
            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-person-badge"></i></span>
              {{ form.apellido }}
            </div>
            {% for e in form.apellido.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
          </div>

          <div class="col-12 col-md-6">
            <label class="form-label mb-1" for="{{ form.correo_electronico.id_for_label }}">Correo electrónico</label>
            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-envelope"></i></span>
              {{ form.correo_electronico }}
            </div>
            {% for e in form.correo_electronico.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
          </div>

          <div class="col-12 col-md-6">
            <label class="form-label mb-1" for="{{ form.id_rol.id_for_label }}">Rol</label>
            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-person-gear"></i></span>
              {{ form.id_rol }}
            </div>
            {% for e in form.id_rol.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
          </div>

          <div class="col-12 col-md-6">
            <label class="form-label mb-1" for="{{ form.contrasena.id_for_label }}">Contraseña</label>
            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-lock"></i></span>
              {{ form.contrasena }}
              <button class="btn btn-outline-secondary" type="button"
                      data-toggle-password="#{{ form.contrasena.id_for_label }}"><i class="bi bi-eye"></i></button>
            </div>
            {% for e in form.contrasena.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
          </div>

          <div class="col-12 col-md-6">
            <label class="form-label mb-1" for="{{ form.confirmar_contrasena.id_for_label }}">Confirmar contraseña</label>
            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-lock-fill"></i></span>
              {{ form.confirmar_contrasena }}
              <button class="btn btn-outline-secondary" type="button"
                      data-toggle-password="#{{ form.confirmar_contrasena.id_for_label }}"><i class="bi bi-eye"></i></button>
            </div>
            {% for e in form.confirmar_contrasena.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
          </div>

        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn btn-light saif-btn-light" data-bs-dismiss="modal">
        <i class="bi bi-x-lg"></i> Cancelar
      </button>
      <button type="submit" class="btn btn-success">
        <i class="bi bi-check2-circle"></i> Guardar
      </button>
    </div>
  </form>
</div>

<script>
/* Este script vive dentro del parcial y usa delegación,
   por lo que funciona aunque el HTML se inserte dinámicamente */
(function () {
  // limitamos el alcance al bloque del modal que está en este mismo parcial
  const root = document.currentScript.closest('.saif-modal') || document;

  root.addEventListener('click', function (ev) {
    const btn = ev.target.closest('[data-toggle-password]');
    if (!btn) return;

    const selector = btn.getAttribute('data-toggle-password'); // ej: "#id_contrasena"
    const input = root.querySelector(selector);
    if (!input) return;

    const icon = btn.querySelector('i');
    const show = input.type === 'password';
    input.type = show ? 'text' : 'password';

    // alternamos iconos
    icon.classList.toggle('bi-eye', !show);
    icon.classList.toggle('bi-eye-slash', show);
  });
})();
</script>
