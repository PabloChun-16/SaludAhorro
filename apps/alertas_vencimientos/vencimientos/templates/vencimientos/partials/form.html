<form id="formReporteVencimiento" class="saif-modal">
  {% csrf_token %}

  <div class="modal-header">
    <div class="saif-modal-title">
      <span class="saif-modal-icon"><i class="bi bi-calendar-x-fill"></i></span>
      <span>Crear Reporte de Vencimiento</span>
    </div>
    <span class="saif-badge">SAIF</span>
  </div>

  <div class="modal-body p-3 p-md-4 saif-modal-body">
    <!-- DATOS PRINCIPALES -->
    <div class="saif-section mb-4">
      <div class="saif-section__title">
        <i class="bi bi-clipboard2-check-fill me-2"></i> Datos del reporte
      </div>

      <div class="row g-3 mt-1">
        <div class="col-md-6">
          <label class="form-label saif-label">Nombre del Reporte</label>
          <div class="input-group">
            <span class="input-group-text saif-ig"><i class="bi bi-file-earmark-text"></i></span>
            <input type="text" class="form-control saif-input" id="id_documento"
                   value="Reporte Vencimiento - {{ today|date:'d/m/Y' }}" />
          </div>
        </div>

        <div class="col-md-6">
          <label class="form-label saif-label">Usuario</label>
          <div class="input-group">
            <span class="input-group-text saif-ig"><i class="bi bi-person-badge"></i></span>
            <input type="text" class="form-control saif-input" value="{{ request.user }}" disabled />
          </div>
        </div>
      </div>
    </div>

    <!-- BUSCAR PRODUCTO Y LOTE -->
    <div class="card border-success shadow-sm mb-4 saif-card">
      <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
        <span class="fw-semibold"><i class="bi bi-search me-2"></i> Buscar Producto con Lote Vencido</span>
        <span class="badge bg-light text-success">Vencimientos</span>
      </div>
      <div class="card-body">
        <div id="formAlertInline" class="alert alert-warning d-none mb-3" role="alert"></div>

        <div class="row g-3 align-items-end">
          <div class="col-12 col-md-7 col-lg-8">
            <label class="form-label saif-label">Producto</label>
            <div class="input-group">
              <span class="input-group-text saif-ig"><i class="bi bi-capsule-pill"></i></span>
              <input id="productoInput" class="form-control saif-input" placeholder="Seleccione producto..." readonly>
              <input id="productoIdInput" type="hidden">
            </div>
          </div>
          <div class="col-6 col-md-3 col-lg-2">
            <button type="button" id="btnBuscarProducto" class="btn btn-outline-success w-100 saif-btn-outline">
              <i class="bi bi-search"></i> Buscar
            </button>
          </div>
        </div>

        <div class="row g-3 align-items-end mt-1">
          <div class="col-12 col-md-7 col-lg-6">
            <label class="form-label saif-label">Lote vencido</label>
            <div class="input-group">
              <span class="input-group-text saif-ig"><i class="bi bi-box-seam"></i></span>
              <input id="loteInput" class="form-control saif-input" placeholder="Seleccione lote vencido..." readonly>
              <input id="loteIdInput" type="hidden">
            </div>
          </div>
          <div class="col-6 col-md-3 col-lg-3">
            <button type="button" id="btnBuscarLote" class="btn btn-outline-success w-100 saif-btn-outline">
              <i class="bi bi-collection"></i> Lotes
            </button>
          </div>
          <div class="col-6 col-md-2 col-lg-3">
            <button type="button" id="btnAgregarDetalle" class="btn btn-success w-100 shadow-sm" disabled>
              <i class="bi bi-plus-circle"></i> Agregar
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- DETALLES AGREGADOS -->
    <div class="saif-section mb-3">
      <div class="saif-section__title">
        <i class="bi bi-list-check me-2"></i> Detalles agregados
      </div>

      <div class="table-responsive mt-2">
        <table class="table table-hover align-middle mb-2 saif-table" id="detalleTable">
          <thead class="table-success">
            <tr>
              <th class="text-center">Producto</th>
              <th class="text-center">Lote</th>
              <th class="text-center">Cantidad Retirada</th>
              <th class="text-center">Acción</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td colspan="4" class="text-muted text-center py-3">
                <i class="bi bi-inbox me-1"></i> Sin productos agregados
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div id="detallePager" class="saif-pager d-none"></div>

      <div class="alert alert-success py-2 px-3 mb-0 saif-hint">
        <i class="bi bi-info-circle me-1"></i>
        Selecciona un producto y luego su lote vencido para añadirlo aquí
      </div>
    </div>

    <div class="mb-2">
      <label class="form-label saif-label">Observaciones</label>
      <textarea id="id_observaciones" class="form-control saif-input" rows="3"
                placeholder="Notas adicionales sobre el retiro..."></textarea>
    </div>
  </div>

  <div class="modal-footer d-flex justify-content-between">
    <button type="button" class="btn btn-light border-success text-success saif-btn-light" data-bs-dismiss="modal">
      <i class="bi bi-x-circle"></i> Cancelar
    </button>
    <button type="submit" class="btn btn-success shadow-sm">
      <i class="bi bi-check-circle"></i> Guardar Reporte
    </button>
  </div>
</form>




